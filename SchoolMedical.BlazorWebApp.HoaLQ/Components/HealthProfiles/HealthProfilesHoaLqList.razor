@page "/HealthProfiles/HealthProfilesList"
@using SchoolMedical.Repositories.HoaLQ.Models
@attribute [StreamRendering]

<h3>Danh sách hồ sơ sức khỏe</h3>

<div class="mb-3">
    <a href="/HealthProfiles/HealthProfilesForm/" class="btn btn-success"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shield-fill-plus" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M8 0c-.69 0-1.843.265-2.928.56-1.11.3-2.229.655-2.887.87a1.54 1.54 0 0 0-1.044 1.262c-.596 4.477.787 7.795 2.465 9.99a11.8 11.8 0 0 0 2.517 2.453c.386.273.744.482 1.048.625.28.132.581.24.829.24s.548-.108.829-.24a7 7 0 0 0 1.048-.625 11.8 11.8 0 0 0 2.517-2.453c1.678-2.195 3.061-5.513 2.465-9.99a1.54 1.54 0 0 0-1.044-1.263 63 63 0 0 0-2.887-.87C9.843.266 8.69 0 8 0m-.5 5a.5.5 0 0 1 1 0v1.5H10a.5.5 0 0 1 0 1H8.5V9a.5.5 0 0 1-1 0V7.5H6a.5.5 0 0 1 0-1h1.5z"/>
    </svg> Tạo mới hồ sơ</a>
</div>
@if (isLoading)
{
    <p  class="text-center">
       <img src="https://i.pinimg.com/originals/41/83/c4/4183c45ac4d96bbd2933ff65810bf5f7.gif" alt="Loading..." />
    </p>
}
else
{
    <table class="table table-bordered table-hover table-striped align-middle text-center shadow-sm rounded bg-white">
        <thead class="table-dark">
        <tr>
            <th>STT</th>
            <th>Học sinh</th>
            <th>Chiều cao (cm)</th>
            <th>Cân nặng (kg)</th>
            <th>Giới tính</th>
            <th>Ngày sinh</th>
            <th>Thao tác</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var healthProfile in healthProfiles.Select((value, index) => new {value, index}))
        {
            <tr>
                <td>@(healthProfile.index + 1 )</td>
                <td>@healthProfile.value.Student.StudentFullName</td>
                <td>@healthProfile.value.Height</td>
                <td>@healthProfile.value.Weight</td>
                <td>
                    <span class="@(healthProfile.value.Sex ? "text-primary" : "text-danger")">
                        @(healthProfile.value.Sex ? "Nam" : "Nữ")
                    </span>
                </td>
                <td>@(healthProfile.value.DateOfBirth.HasValue ? healthProfile.value.DateOfBirth.Value.ToString("dd/MM/yyyy") : "--")</td>
                <td>
                    <div class="flex flex-row align-items-center gap-2">
                        <!-- Hàng trên: Chi tiết + Sửa -->
                            <a class="btn btn-sm btn-info text-white rounded-3"
                               href="/HealthProfiles/HealthProfilesDetail/@healthProfile.value.HealthProfileHoaLqid">
                                Chi tiết
                            </a>
                            <a class="btn btn-sm btn-warning text-white rounded-3"
                               href="/HealthProfiles/HealthProfilesForm/@healthProfile.value.HealthProfileHoaLqid">
                                Sửa
                            </a>

                        <!-- Hàng dưới: nút Xóa ở giữa -->
                        <a class="btn btn-sm btn-danger rounded-3"
                           href="/">
                            Xóa
                        </a>
                    </div>
                </td>
            </tr>
        }
        </tbody>
    </table>
}

@code {
    private List<HealthProfilesHoaLq> healthProfiles = new();
    private bool isLoading = true;
    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(500);
        healthProfiles = await ServiceProvider.HealthProfilesHoaLqService.GetAllAsync();
        isLoading = false;
    }
}
